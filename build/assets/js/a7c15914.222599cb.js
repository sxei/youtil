"use strict";(self.webpackChunkyoutil=self.webpackChunkyoutil||[]).push([[210],{2207:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>g,contentTitle:()=>c,default:()=>h,frontMatter:()=>p,metadata:()=>d,toc:()=>m});var t,r=a(8168),s=a(8587),o=(a(6540),a(6665)),l=a(8478),i=a(8279),u=["components"],p={},c="request",d={unversionedId:"request",id:"request",title:"request",description:"request\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684API\u8bf7\u6c42\u51fd\u6570\uff0c\u4e3b\u8981\u7279\u70b9\uff1a",source:"@site/docs/01-request.md",sourceDirName:".",slug:"/request",permalink:"/request",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"\u9996\u9875",permalink:"/"},next:{title:"\u6d4b\u8bd5",permalink:"/time"}},g={},m=[{value:"\u5982\u4f55\u4f7f\u7528",id:"\u5982\u4f55\u4f7f\u7528",level:2},{value:"\u5178\u578b\u793a\u4f8b",id:"\u5178\u578b\u793a\u4f8b",level:2},{value:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848",id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848",level:2},{value:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406",id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406",level:2},{value:"\u9759\u9ed8\u8bf7\u6c42",id:"\u9759\u9ed8\u8bf7\u6c42",level:2},{value:"loading\u5904\u7406",id:"loading\u5904\u7406",level:2},{value:"\u81ea\u5b9a\u4e49baseURL",id:"\u81ea\u5b9a\u4e49baseurl",level:2},{value:"\u81ea\u5b9a\u4e49 axios \u914d\u7f6e",id:"\u81ea\u5b9a\u4e49-axios-\u914d\u7f6e",level:2},{value:"\u975e\u6807\u573a\u666f\u517c\u5bb9",id:"\u975e\u6807\u573a\u666f\u517c\u5bb9",level:2},{value:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c",id:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c",level:2},{value:"GET\u8bf7\u6c42",id:"get\u8bf7\u6c42",level:2},{value:"POST\u8bf7\u6c42",id:"post\u8bf7\u6c42",level:2},{value:"formData\u6a21\u5f0f",id:"formdata\u6a21\u5f0f",level:2},{value:"PostJson\u8bf7\u6c42",id:"postjson\u8bf7\u6c42",level:2},{value:"\u672a\u5b8c\u5f85\u7eed",id:"\u672a\u5b8c\u5f85\u7eed",level:2}],y=(t="IcePkgDemo_docs_01_request_0",{toc:m}),f="wrapper";function h(e){var n=e.components,t=(0,s.A)(e,u);return(0,o.yg)(f,(0,r.A)({},y,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"request"},"request"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"request"),"\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684API\u8bf7\u6c42\u51fd\u6570\uff0c\u4e3b\u8981\u7279\u70b9\uff1a"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"\u4f7f\u7528\u7b80\u5355\uff0c\u9ad8\u5ea6\u96c6\u6210\uff0c\u53ea\u66b4\u9732\u51e0\u4e2a\u7b80\u5355\u7684\u53c2\u6570\uff0c\u5185\u7f6e\u4e86\u53c2\u6570\u5904\u7406\u3001\u5f02\u5e38\u515c\u5e95\u5904\u7406\u7b49\uff1b"),(0,o.yg)("li",{parentName:"ul"},"\u57fa\u4e8e\u73b0\u4ee3\u5316\u7684",(0,o.yg)("inlineCode",{parentName:"li"},"fetch"),"\uff0c\u5e76\u5f00\u653e\u6240\u6709\u5e95\u5c42\u914d\u7f6e\uff1b"),(0,o.yg)("li",{parentName:"ul"},"\u5021\u5bfc\u7528\u201c\u540c\u6b65\u201d\u7684\u601d\u60f3\u53bb\u5199\u5f02\u6b65\u4ee3\u7801\uff0c\u53d1\u751f\u5f02\u5e38\u9ed8\u8ba4\u4e2d\u65ad\u6267\u884c\uff0c\u5f00\u53d1\u8005\u53ea\u9700\u8981\u5173\u6ce8\u6210\u529f\u5904\u7406\u903b\u8f91\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\u65e0\u9700\u5173\u5fc3\u5f02\u5e38\u515c\u5e95\uff0c\u65e0\u9700",(0,o.yg)("inlineCode",{parentName:"li"},"try-catch"),"\uff1b")),(0,o.yg)("h2",{id:"\u5982\u4f55\u4f7f\u7528"},"\u5982\u4f55\u4f7f\u7528"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"requestOptions"),"\u5b8c\u6574\u53c2\u6570\u8be6\u89c1",(0,o.yg)("a",{parentName:"p",href:"/docs/api/interfaces/IRequestOptions"},"\u8fd9\u91cc"),"\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"import { request } from 'youtil';\nconst data = await requestAPI(url, requestOptions);\n")),(0,o.yg)("h2",{id:"\u5178\u578b\u793a\u4f8b"},"\u5178\u578b\u793a\u4f8b"),(0,o.yg)(i.A,{code:"import { request, Request } from 'youtil';\nimport { useEffect } from 'react';\n\nvar request2 = new Request({ errorMessage: '\u6211\u662f222', fetchOptions: {} });\nvar request3 = new Request({ baseUrl: '/api/' }, request2);\nexport default () => {\n  const test = async () => {\n    const a = await request2('test-post', { data: {a: 1}, onFetchResponse: resp => ({ code: 0, data: resp.headers }) });\n    console.log(a, Object.fromEntries(a.entries()));\n    \n  }\n  return <div>\n    <a href=\"javascript:;\" onClick={test}>\u70b9\u51fb\u8bf7\u6c42</a>\n  </div>;\n}",mobilePreview:!1,url:"/demos/IcePkgDemo_docs_01_request_0/?",mdxType:"Previewer"},(0,o.yg)(l.A,{mdxType:"BrowserOnly"},(function(){var e=a(4916).A;return(0,o.yg)(e,{mdxType:"IcePkgDemo_docs_01_request_0"})}))),(0,o.yg)("h2",{id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848"},"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx', { errorMessage: '\u7cfb\u7edf\u7e41\u5fd9\uff0c\u7a0d\u540e\u518d\u8bd5\uff01' });\n")),(0,o.yg)("h2",{id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406"},"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const errorHandler = (message: string, resp: any) => {\n  if (resp?.busiCode === '3') {\n    Toast.show({ title: '\u6211\u662f\u81ea\u5b9a\u4e49\u7279\u6b8a\u5f02\u5e38', icon: 'error' });\n  }\n  Toast.show({ title: message, icon: 'error' });\n  // \u629b\u51fa\u5f02\u5e38\uff0c\u963b\u6b62\u6267\u884c\u4e4b\u540e\u7684\u64cd\u4f5c\n  throw new Error(message);\n}\nawait requestAPI('xxx', { errorHandler });\n")),(0,o.yg)("h2",{id:"\u9759\u9ed8\u8bf7\u6c42"},"\u9759\u9ed8\u8bf7\u6c42"),(0,o.yg)("p",null,"\u6709\u4e9b\u65f6\u5019\u53ef\u80fd\u4e0d\u5173\u6ce8\u8bf7\u6c42\u5f02\u5e38\uff0c\u671f\u671b\u53d1\u751f\u5f02\u5e38\u65f6\u4e0d\u544a\u77e5\u7528\u6237\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx', { silent: true });\n")),(0,o.yg)("h2",{id:"loading\u5904\u7406"},"loading\u5904\u7406"),(0,o.yg)("p",null,"\u4e00\u822c\u5728\u8bf7\u6c42\u5f00\u59cb\u663e\u793aloading\uff0c\u8bf7\u6c42\u7ed3\u675f\u65e0\u8bba\u6210\u529f\u4e0e\u5426\u5173\u95edloading\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,o.yg)("inlineCode",{parentName:"p"},"afterRequest"),"\u94a9\u5b50\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst afterRequest = (success: boolean, resp: any) => setLoading(false); \nawait requestAPI('xxx', { afterRequest });\n")),(0,o.yg)("h2",{id:"\u81ea\u5b9a\u4e49baseurl"},"\u81ea\u5b9a\u4e49baseURL"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst baseURL= '//xxx.jd.com';\nawait requestAPI('xxx', { baseURL });\n")),(0,o.yg)("h2",{id:"\u81ea\u5b9a\u4e49-axios-\u914d\u7f6e"},"\u81ea\u5b9a\u4e49 axios \u914d\u7f6e"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst axiosOptions = {\n  timeout: 30000,\n};\nawait requestAPI('xxx', { axiosOptions });\n")),(0,o.yg)("h2",{id:"\u975e\u6807\u573a\u666f\u517c\u5bb9"},"\u975e\u6807\u573a\u666f\u517c\u5bb9"),(0,o.yg)("p",null,"requestAPI\u9ed8\u8ba4\u8981\u6c42\u54cd\u5e94\u9700\u8981\u6ee1\u8db3\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-ts"},"export interface IResponse {\n  // \u4e3a0\u8868\u793a\u6210\u529f\n  busiCode?: string;\n  // \u4e3a0\u8868\u793a\u6210\u529f\n  resultCode?: string;\n  data: any;\n  message?: string;\n}\n")),(0,o.yg)("p",null,"\u5bf9\u4e8e\u975e\u6807\u8fd4\u56de\u53ef\u4ee5\u901a\u8fc7",(0,o.yg)("inlineCode",{parentName:"p"},"responseConverter"),"\u8fdb\u884c\u683c\u5f0f\u5316\u540e\u517c\u5bb9\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const responseConverter = resp => {\n  if (resp) {\n    resp.resultCode = resp.xxxCode;\n  }\n  return resp;\n};\nawait requestAPI('xxx', { responseConverter });\n")),(0,o.yg)("h2",{id:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c"},"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c"),(0,o.yg)("p",null,"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c\u662f\u901a\u8fc7",(0,o.yg)("inlineCode",{parentName:"p"},"errorHandler"),"\u4e2d\u7684",(0,o.yg)("inlineCode",{parentName:"p"},"throw new Error"),"\u5b9e\u73b0\u7684\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx');\nconsole.log('\u5982\u679c\u53d1\u751f\u5f02\u5e38\uff0c\u8fd9\u6761console.log\u4e0d\u4f1a\u6267\u884c');\n")),(0,o.yg)("p",null,"\u8fd9\u79cd\u60c5\u51b5\u4e0b\u63a7\u5236\u53f0\u4f1a\u4ea7\u751f\u4e00\u6761\u672a\u5904\u7406\u7684\u5f02\u5e38\u65e5\u5fd7\uff0c\u5982\u679c\u786e\u5b9e\u6709\u5f3a\u8feb\u75c7\u4e0d\u559c\u6b22\u8fd9\u79cd\u6a21\u5f0f\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"requestAPI"),"\u4e5f\u662f\u652f\u6301",(0,o.yg)("inlineCode",{parentName:"p"},"try-catch"),"\u7684\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"try {\n  await requestAPI('xxx');\n} catch (e) {\n}\nconsole.log('\u5982\u679c\u53d1\u751f\u5f02\u5e38\uff0c\u8fd9\u6761console.log\u4ecd\u7136\u4f1a\u6267\u884c');\n")),(0,o.yg)("h2",{id:"get\u8bf7\u6c42"},"GET\u8bf7\u6c42"),(0,o.yg)("p",null,"\u4f20\u5165",(0,o.yg)("inlineCode",{parentName:"p"},"params"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,o.yg)("inlineCode",{parentName:"p"},"GET"),"\u5904\u7406\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const params = {};\nawait requestAPI('xxx', { params });\n")),(0,o.yg)("h2",{id:"post\u8bf7\u6c42"},"POST\u8bf7\u6c42"),(0,o.yg)("p",null,"\u4f20\u5165",(0,o.yg)("inlineCode",{parentName:"p"},"data"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,o.yg)("inlineCode",{parentName:"p"},"POST"),"\u5904\u7406\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const data = {};\nawait requestAPI('xxx', { data });\n")),(0,o.yg)("h2",{id:"formdata\u6a21\u5f0f"},"formData\u6a21\u5f0f"),(0,o.yg)("p",null,"\u4f20\u5165",(0,o.yg)("inlineCode",{parentName:"p"},"formData"),"\u53c2\u6570\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const formData = {\n  file: SomeFile,\n};\nawait requestAPI('xxx', { formData });\n")),(0,o.yg)("h2",{id:"postjson\u8bf7\u6c42"},"PostJson\u8bf7\u6c42"),(0,o.yg)("p",null,"\u4f20\u5165",(0,o.yg)("inlineCode",{parentName:"p"},"json"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,o.yg)("inlineCode",{parentName:"p"},"postJson"),"\u6a21\u5f0f\u5904\u7406\uff1a"),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"\u6240\u8c13",(0,o.yg)("inlineCode",{parentName:"p"},"postJson"),"\u6a21\u5f0f\uff1a",(0,o.yg)("inlineCode",{parentName:"p"},"POST")," + ",(0,o.yg)("inlineCode",{parentName:"p"},"Content-Type: 'application/json'"),"\uff1a")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const json = {};\nawait requestAPI('xxx', { json });\n")),(0,o.yg)("h2",{id:"\u672a\u5b8c\u5f85\u7eed"},"\u672a\u5b8c\u5f85\u7eed"))}h.isMDXComponent=!0},4916:(e,n,a)=>{a.d(n,{A:()=>y});var t,r=a(675),s=a(467),o=a(858),l=a(4898),i=a(7890),u=a(1635),p=function(e){return Object.keys(e||{}).filter((function(n){return void 0!==e[n]})).map((function(n){var a="object"==typeof e[n]?JSON.stringify(e[n]):e[n];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(a))})).join("&")},c=(t=(0,o.A)((function(e,n){var a,t,r,s,o,c,d,g,m,y,f,h,v,x,N,q,w,C,j,A;return(0,u.YH)(this,(function(u){switch(u.label){case 0:if(a={errorMessage:"\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",errorHandler:function(e){var a;throw(null==n?void 0:n.silent)||null==n||null===(a=n.toastHandler)||void 0===a||a.call(n,e),new Error(e)},baseUrl:"",headers:{},fetchOptions:{credentials:"include"},checkSuccess:function(e){return 0==(null==e?void 0:e.code)||200==(null==e?void 0:e.code)},toastHandler:function(e){return console.error("[\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6etoastHandler\uff0c\u8bf7\u6839\u636e\u60a8\u7684UI\u7ec4\u4ef6\u5e93\u914d\u7f6e\u5408\u9002\u7684\u63d0\u793a\u65b9\u6cd5] ".concat(e||""))},onFetchResponse:function(e){if(200===e.status)return e.json();var n={code:e.status,message:e.statusText,headers:e.headers,_response:e},a=new Error(n.message);throw a.response=n,a}},(n=Object.assign({},a,n||{})).fetchOptions=(0,i.A)({},n.fetchOptions||{}),r=(t=n||{}).params,s=t.data,o=t.formData,c=t.json,d=t.method,g=t.headers,m=t.baseUrl,y=t.fetchOptions,f=t.checkSuccess,h=t.afterRequest,v=t.errorHandler,x=t.errorMessage,N=t.responseConverter,q=t.onFetchResponse,y.headers=(0,i.A)({},g||{},y.headers||{}),r&&(y.method=d||"GET",e="".concat(e).concat(e.indexOf("?")>=0?"&":"?").concat(p(r))),s)Object.assign(y,{method:d||"POST",body:p(s),headers:(0,i.A)({"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},y.headers||{})});else if(o){if(w=o,!(0,l.A)(o,FormData))for(var b in w=new FormData,o)w.append(b,o[b]);Object.assign(y,{method:d||"POST",body:w})}else c&&Object.assign(y,{method:d||"POST",body:JSON.stringify(c),headers:(0,i.A)({"Content-Type":"application/json;charset=utf-8"},y.headers||{})});C=null,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,fetch("".concat(m||"").concat(e),y).then(q)];case 2:return C=u.sent(),[3,4];case 3:return j=u.sent(),console.error(j),null==h||h(!1,{message:null==j?void 0:j.message}),null==v||v((null===(A=j.response)||void 0===A?void 0:A.message)||x||"",j.response),[2,void 0];case 4:return C=N?N(C):C,(null==f?void 0:f(C))?(null==h||h(!0,C),[2,C.data]):(null==h||h(!1,C),null==v||v(C.message||C.msg||x||"",C),[2,void 0])}}))})),function(e,n){return t.apply(this,arguments)}),d=function(e,n){var a=n;return n||(a=e,e=c),function(n,t){return e(n,(0,i.A)({},a||{},t||{}))}},g=(a(6540),a(757).A),m=new d({errorMessage:"\u6211\u662f222",fetchOptions:{}});new d({baseUrl:"/api/"},m);const y=function(){var e=function(){var e=(0,s.A)((0,r.A)().mark((function e(){var n;return(0,r.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m("test-post",{data:{a:1},onFetchResponse:function(e){return{code:0,data:e.headers}}});case 2:n=e.sent,console.log(n,Object.fromEntries(n.entries()));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g("div",null,g("a",{href:"javascript:;",onClick:e},"\u70b9\u51fb\u8bf7\u6c42"))}}}]);