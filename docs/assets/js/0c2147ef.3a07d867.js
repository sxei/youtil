"use strict";(self.webpackChunkyoutil=self.webpackChunkyoutil||[]).push([[185],{3894:(e,n,r)=>{r.d(n,{K:()=>d,E:()=>c});var t,a=r(858),s=r(4898),o=r(7890),l=r(1635),i=function(e){return Object.keys(e||{}).filter((function(n){return void 0!==e[n]})).map((function(n){var r="object"==typeof e[n]?JSON.stringify(e[n]):e[n];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r))})).join("&")},u=function(e,n){var r=Object.assign({},e||{},n||{});return r.headers=(0,o.A)({},r.headers||{}),r.fetchOptions=(0,o.A)({},r.fetchOptions||{}),r},c=(t=(0,a.A)((function(e,n){var r,t,a,c,p,d,g,m,y,v,f,h,x,q,N,w,A,C,b,P;return(0,l.YH)(this,(function(l){switch(l.label){case 0:if(r={errorMessage:"\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",errorHandler:function(e){var r;throw(null==n?void 0:n.silent)||null==n||null===(r=n.toastHandler)||void 0===r||r.call(n,e),new Error(e)},baseUrl:"",headers:{},fetchOptions:{credentials:"include"},checkSuccess:function(e){return 0==(null==e?void 0:e.code)||200==(null==e?void 0:e.code)},toastHandler:function(e){return console.error("[\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6etoastHandler\uff0c\u8bf7\u6839\u636e\u60a8\u7684UI\u7ec4\u4ef6\u5e93\u914d\u7f6e\u5408\u9002\u7684\u63d0\u793a\u65b9\u6cd5] ".concat(e||""))},onFetchResponse:function(e){if(200===e.status)return e.json();var n={code:e.status,status:e.status,message:e.statusText,headers:e.headers,_response:e},r=new Error(n.message);throw r.response=n,r}},n=u(r,n),a=(t=n||{}).params,c=t.data,p=t.formData,d=t.json,g=t.method,m=t.headers,y=t.baseUrl,v=t.fetchOptions,f=t.checkSuccess,h=t.afterRequest,x=t.errorHandler,q=t.errorMessage,N=t.responseConverter,w=t.onFetchResponse,v.headers=(0,o.A)({},m||{},v.headers||{}),a&&(v.method=g||"GET",e="".concat(e).concat(e.indexOf("?")>=0?"&":"?").concat(i(a))),c)Object.assign(v,{method:g||"POST",body:i(c),headers:(0,o.A)({"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},v.headers||{})});else if(p){if(A=p,!(0,s.A)(p,FormData))for(var j in A=new FormData,p)A.append(j,p[j]);Object.assign(v,{method:g||"POST",body:A})}else d&&Object.assign(v,{method:g||"POST",body:JSON.stringify(d),headers:(0,o.A)({"Content-Type":"application/json;charset=utf-8"},v.headers||{})});C=null,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,fetch("".concat(y||"").concat(e),v).then(w)];case 2:return C=l.sent(),[3,4];case 3:return b=l.sent(),console.error(b),null==h||h(!1,{message:null==b?void 0:b.message}),null==x||x((null===(P=b.response)||void 0===P?void 0:P.message)||q||"",b.response),[2,void 0];case 4:return C=N?N(C):C,(null==f?void 0:f(C))?(null==h||h(!0,C),[2,C.data]):(null==h||h(!1,C),null==x||x(C.message||C.msg||q||"",C),[2,void 0])}}))})),function(e,n){return t.apply(this,arguments)}),p=function(e){var n=u(this.overrideDefaultOptions,e),r=function(e,r){return c(e,u(n,r))};return r.overrideDefaultOptions=n,r.create=p.bind(r),r};c.create=p.bind(c);var d=function(e,n){var r=n;return n||(r=e,e=c),function(n,t){return e(n,(0,o.A)({},r||{},t||{}))}}},6618:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>f,frontMatter:()=>u,metadata:()=>p,toc:()=>g});var t=r(8168),a=r(8587),s=(r(6540),r(6665)),o=r(8478),l=r(8279),i=["components"],u={},c="request",p={unversionedId:"request",id:"request",title:"request",description:"request\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684API\u8bf7\u6c42\u51fd\u6570\uff0c\u4e3b\u8981\u7279\u70b9\uff1a",source:"@site/doc/01-request.md",sourceDirName:".",slug:"/request",permalink:"/request",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"\u9996\u9875",permalink:"/"},next:{title:"\u6d4b\u8bd5",permalink:"/time"}},d={},g=[{value:"\u5982\u4f55\u4f7f\u7528",id:"\u5982\u4f55\u4f7f\u7528",level:2},{value:"\u5178\u578b\u793a\u4f8b",id:"\u5178\u578b\u793a\u4f8b",level:2},{value:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848",id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848",level:2},{value:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406",id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406",level:2},{value:"\u9759\u9ed8\u8bf7\u6c42",id:"\u9759\u9ed8\u8bf7\u6c42",level:2},{value:"loading\u5904\u7406",id:"loading\u5904\u7406",level:2},{value:"\u81ea\u5b9a\u4e49baseURL",id:"\u81ea\u5b9a\u4e49baseurl",level:2},{value:"\u81ea\u5b9a\u4e49 axios \u914d\u7f6e",id:"\u81ea\u5b9a\u4e49-axios-\u914d\u7f6e",level:2},{value:"\u975e\u6807\u573a\u666f\u517c\u5bb9",id:"\u975e\u6807\u573a\u666f\u517c\u5bb9",level:2},{value:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c",id:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c",level:2},{value:"GET\u8bf7\u6c42",id:"get\u8bf7\u6c42",level:2},{value:"POST\u8bf7\u6c42",id:"post\u8bf7\u6c42",level:2},{value:"formData\u6a21\u5f0f",id:"formdata\u6a21\u5f0f",level:2},{value:"PostJson\u8bf7\u6c42",id:"postjson\u8bf7\u6c42",level:2},{value:"\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b",id:"\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b",level:2},{value:"\u672a\u5b8c\u5f85\u7eed",id:"\u672a\u5b8c\u5f85\u7eed",level:2}],m=function(e){return function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.yg)("div",n)}},y=(m("IcePkgDemo_doc_01_request_0"),m("IcePkgDemo_doc_01_request_1"),{toc:g}),v="wrapper";function f(e){var n=e.components,u=(0,a.A)(e,i);return(0,s.yg)(v,(0,t.A)({},y,u,{components:n,mdxType:"MDXLayout"}),(0,s.yg)("h1",{id:"request"},"request"),(0,s.yg)("p",null,(0,s.yg)("inlineCode",{parentName:"p"},"request"),"\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684API\u8bf7\u6c42\u51fd\u6570\uff0c\u4e3b\u8981\u7279\u70b9\uff1a"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"\u4f7f\u7528\u7b80\u5355\uff0c\u9ad8\u5ea6\u96c6\u6210\uff0c\u53ea\u66b4\u9732\u51e0\u4e2a\u7b80\u5355\u7684\u53c2\u6570\uff0c\u5185\u7f6e\u4e86\u53c2\u6570\u5904\u7406\u3001\u5f02\u5e38\u515c\u5e95\u5904\u7406\u7b49\uff1b"),(0,s.yg)("li",{parentName:"ul"},"\u57fa\u4e8e\u73b0\u4ee3\u5316\u7684",(0,s.yg)("inlineCode",{parentName:"li"},"fetch"),"\uff0c\u5e76\u5f00\u653e\u6240\u6709\u5e95\u5c42\u914d\u7f6e\uff1b"),(0,s.yg)("li",{parentName:"ul"},"\u5021\u5bfc\u7528\u201c\u540c\u6b65\u201d\u7684\u601d\u60f3\u53bb\u5199\u5f02\u6b65\u4ee3\u7801\uff0c\u53d1\u751f\u5f02\u5e38\u9ed8\u8ba4\u4e2d\u65ad\u6267\u884c\uff0c\u5f00\u53d1\u8005\u53ea\u9700\u8981\u5173\u6ce8\u6210\u529f\u5904\u7406\u903b\u8f91\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\u65e0\u9700\u5173\u5fc3\u5f02\u5e38\u515c\u5e95\uff0c\u65e0\u9700",(0,s.yg)("inlineCode",{parentName:"li"},"try-catch"),"\uff1b")),(0,s.yg)("h2",{id:"\u5982\u4f55\u4f7f\u7528"},"\u5982\u4f55\u4f7f\u7528"),(0,s.yg)("p",null,(0,s.yg)("inlineCode",{parentName:"p"},"requestOptions"),"\u5b8c\u6574\u53c2\u6570\u8be6\u89c1",(0,s.yg)("a",{parentName:"p",href:"/docs/api/interfaces/IRequestOptions"},"\u8fd9\u91cc"),"\u3002"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"import { request } from 'youtil';\nconst data = await requestAPI(url, requestOptions);\n")),(0,s.yg)("h2",{id:"\u5178\u578b\u793a\u4f8b"},"\u5178\u578b\u793a\u4f8b"),(0,s.yg)(l.A,{code:"import { request, Request } from 'youtil';\nimport { useEffect } from 'react';\n\nvar request2 = new Request({ errorMessage: '\u6211\u662f222', fetchOptions: {} });\nvar request3 = new Request({ baseUrl: '/api/' }, request2);\nexport default () => {\n  const test = async () => {\n    const a = await request2('test-post', { data: {a: 1}, onFetchResponse: resp => ({ code: 0, data: resp.headers }) });\n    console.log(a, Object.fromEntries(a.entries()));\n    \n  }\n  return <div>\n    <a href=\"javascript:;\" onClick={test}>\u70b9\u51fb\u8bf7\u6c42</a>\n  </div>;\n}",mobilePreview:!1,url:"/demos/IcePkgDemo_doc_01_request_0/?",mdxType:"Previewer"},(0,s.yg)(o.A,{mdxType:"BrowserOnly"},(function(){var e=r(8486).A;return(0,s.yg)(e,{mdxType:"IcePkgDemo_doc_01_request_0"})}))),(0,s.yg)("h2",{id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848"},"\u81ea\u5b9a\u4e49\u5f02\u5e38\u515c\u5e95\u6587\u6848"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx', { errorMessage: '\u7cfb\u7edf\u7e41\u5fd9\uff0c\u7a0d\u540e\u518d\u8bd5\uff01' });\n")),(0,s.yg)("h2",{id:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406"},"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const errorHandler = (message: string, resp: any) => {\n  if (resp?.busiCode === '3') {\n    Toast.show({ title: '\u6211\u662f\u81ea\u5b9a\u4e49\u7279\u6b8a\u5f02\u5e38', icon: 'error' });\n  }\n  Toast.show({ title: message, icon: 'error' });\n  // \u629b\u51fa\u5f02\u5e38\uff0c\u963b\u6b62\u6267\u884c\u4e4b\u540e\u7684\u64cd\u4f5c\n  throw new Error(message);\n}\nawait requestAPI('xxx', { errorHandler });\n")),(0,s.yg)("h2",{id:"\u9759\u9ed8\u8bf7\u6c42"},"\u9759\u9ed8\u8bf7\u6c42"),(0,s.yg)("p",null,"\u6709\u4e9b\u65f6\u5019\u53ef\u80fd\u4e0d\u5173\u6ce8\u8bf7\u6c42\u5f02\u5e38\uff0c\u671f\u671b\u53d1\u751f\u5f02\u5e38\u65f6\u4e0d\u544a\u77e5\u7528\u6237\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx', { silent: true });\n")),(0,s.yg)("h2",{id:"loading\u5904\u7406"},"loading\u5904\u7406"),(0,s.yg)("p",null,"\u4e00\u822c\u5728\u8bf7\u6c42\u5f00\u59cb\u663e\u793aloading\uff0c\u8bf7\u6c42\u7ed3\u675f\u65e0\u8bba\u6210\u529f\u4e0e\u5426\u5173\u95edloading\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,s.yg)("inlineCode",{parentName:"p"},"afterRequest"),"\u94a9\u5b50\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst afterRequest = (success: boolean, resp: any) => setLoading(false); \nawait requestAPI('xxx', { afterRequest });\n")),(0,s.yg)("h2",{id:"\u81ea\u5b9a\u4e49baseurl"},"\u81ea\u5b9a\u4e49baseURL"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst baseURL= '//xxx.jd.com';\nawait requestAPI('xxx', { baseURL });\n")),(0,s.yg)("h2",{id:"\u81ea\u5b9a\u4e49-axios-\u914d\u7f6e"},"\u81ea\u5b9a\u4e49 axios \u914d\u7f6e"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"setLoading(true);\nconst axiosOptions = {\n  timeout: 30000,\n};\nawait requestAPI('xxx', { axiosOptions });\n")),(0,s.yg)("h2",{id:"\u975e\u6807\u573a\u666f\u517c\u5bb9"},"\u975e\u6807\u573a\u666f\u517c\u5bb9"),(0,s.yg)("p",null,"requestAPI\u9ed8\u8ba4\u8981\u6c42\u54cd\u5e94\u9700\u8981\u6ee1\u8db3\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-ts"},"export interface IResponse {\n  // \u4e3a0\u8868\u793a\u6210\u529f\n  busiCode?: string;\n  // \u4e3a0\u8868\u793a\u6210\u529f\n  resultCode?: string;\n  data: any;\n  message?: string;\n}\n")),(0,s.yg)("p",null,"\u5bf9\u4e8e\u975e\u6807\u8fd4\u56de\u53ef\u4ee5\u901a\u8fc7",(0,s.yg)("inlineCode",{parentName:"p"},"responseConverter"),"\u8fdb\u884c\u683c\u5f0f\u5316\u540e\u517c\u5bb9\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const responseConverter = resp => {\n  if (resp) {\n    resp.resultCode = resp.xxxCode;\n  }\n  return resp;\n};\nawait requestAPI('xxx', { responseConverter });\n")),(0,s.yg)("h2",{id:"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c"},"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c"),(0,s.yg)("p",null,"\u5f02\u5e38\u4e2d\u65ad\u6267\u884c\u662f\u901a\u8fc7",(0,s.yg)("inlineCode",{parentName:"p"},"errorHandler"),"\u4e2d\u7684",(0,s.yg)("inlineCode",{parentName:"p"},"throw new Error"),"\u5b9e\u73b0\u7684\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"await requestAPI('xxx');\nconsole.log('\u5982\u679c\u53d1\u751f\u5f02\u5e38\uff0c\u8fd9\u6761console.log\u4e0d\u4f1a\u6267\u884c');\n")),(0,s.yg)("p",null,"\u8fd9\u79cd\u60c5\u51b5\u4e0b\u63a7\u5236\u53f0\u4f1a\u4ea7\u751f\u4e00\u6761\u672a\u5904\u7406\u7684\u5f02\u5e38\u65e5\u5fd7\uff0c\u5982\u679c\u786e\u5b9e\u6709\u5f3a\u8feb\u75c7\u4e0d\u559c\u6b22\u8fd9\u79cd\u6a21\u5f0f\uff0c",(0,s.yg)("inlineCode",{parentName:"p"},"requestAPI"),"\u4e5f\u662f\u652f\u6301",(0,s.yg)("inlineCode",{parentName:"p"},"try-catch"),"\u7684\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"try {\n  await requestAPI('xxx');\n} catch (e) {\n}\nconsole.log('\u5982\u679c\u53d1\u751f\u5f02\u5e38\uff0c\u8fd9\u6761console.log\u4ecd\u7136\u4f1a\u6267\u884c');\n")),(0,s.yg)("h2",{id:"get\u8bf7\u6c42"},"GET\u8bf7\u6c42"),(0,s.yg)("p",null,"\u4f20\u5165",(0,s.yg)("inlineCode",{parentName:"p"},"params"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,s.yg)("inlineCode",{parentName:"p"},"GET"),"\u5904\u7406\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const params = {};\nawait requestAPI('xxx', { params });\n")),(0,s.yg)("h2",{id:"post\u8bf7\u6c42"},"POST\u8bf7\u6c42"),(0,s.yg)("p",null,"\u4f20\u5165",(0,s.yg)("inlineCode",{parentName:"p"},"data"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,s.yg)("inlineCode",{parentName:"p"},"POST"),"\u5904\u7406\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const data = {};\nawait requestAPI('xxx', { data });\n")),(0,s.yg)("h2",{id:"formdata\u6a21\u5f0f"},"formData\u6a21\u5f0f"),(0,s.yg)("p",null,"\u4f20\u5165",(0,s.yg)("inlineCode",{parentName:"p"},"formData"),"\u53c2\u6570\uff1a"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const formData = {\n  file: SomeFile,\n};\nawait requestAPI('xxx', { formData });\n")),(0,s.yg)("h2",{id:"postjson\u8bf7\u6c42"},"PostJson\u8bf7\u6c42"),(0,s.yg)("p",null,"\u4f20\u5165",(0,s.yg)("inlineCode",{parentName:"p"},"json"),"\u53c2\u6570\u4f1a\u9ed8\u8ba4\u6309\u7167",(0,s.yg)("inlineCode",{parentName:"p"},"postJson"),"\u6a21\u5f0f\u5904\u7406\uff1a"),(0,s.yg)("blockquote",null,(0,s.yg)("p",{parentName:"blockquote"},"\u6240\u8c13",(0,s.yg)("inlineCode",{parentName:"p"},"postJson"),"\u6a21\u5f0f\uff1a",(0,s.yg)("inlineCode",{parentName:"p"},"POST")," + ",(0,s.yg)("inlineCode",{parentName:"p"},"Content-Type: 'application/json'"),"\uff1a")),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},"const json = {};\nawait requestAPI('xxx', { json });\n")),(0,s.yg)("h2",{id:"\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b"},"\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b"),(0,s.yg)(l.A,{code:"import { request, Request } from 'youtil';\nimport { useEffect } from 'react';\n\nvar request2 = request.create({\n  baseUrl: 'http://xxx.com',\n  errorMessage: '\u62a5\u9519\u5566\u5566\u5566',\n});\nconsole.log(request2.overrideOptions);\n\nvar request3 = request2.create({\n  toastHandler: msg => alert(msg),\n});\nconsole.log(request3.overrideOptions);\n\nexport default () => {\n  const test = async () => {\n    await request3('/test', { data: {a: 1} });\n  }\n  return <div>\n    <a href=\"javascript:;\" onClick={test}>\u70b9\u51fb\u8bf7\u6c42</a>\n  </div>;\n}",mobilePreview:!1,url:"/demos/IcePkgDemo_doc_01_request_1/?",mdxType:"Previewer"},(0,s.yg)(o.A,{mdxType:"BrowserOnly"},(function(){var e=r(8419).A;return(0,s.yg)(e,{mdxType:"IcePkgDemo_doc_01_request_1"})}))),(0,s.yg)("h2",{id:"\u672a\u5b8c\u5f85\u7eed"},"\u672a\u5b8c\u5f85\u7eed"))}f.isMDXComponent=!0},8419:(e,n,r)=>{r.d(n,{A:()=>u});var t=r(675),a=r(467),s=r(3894),o=(r(6540),r(757).A),l=s.E.create({baseUrl:"http://xxx.com",errorMessage:"\u62a5\u9519\u5566\u5566\u5566"});console.log(l.overrideOptions);var i=l.create({toastHandler:function(e){return alert(e)}});console.log(i.overrideOptions);const u=function(){var e=function(){var e=(0,a.A)((0,t.A)().mark((function e(){return(0,t.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("/test",{data:{a:1}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o("div",null,o("a",{href:"javascript:;",onClick:e},"\u70b9\u51fb\u8bf7\u6c42"))}},8486:(e,n,r)=>{r.d(n,{A:()=>i});var t=r(675),a=r(467),s=r(3894),o=(r(6540),r(757).A),l=new s.K({errorMessage:"\u6211\u662f222",fetchOptions:{}});new s.K({baseUrl:"/api/"},l);const i=function(){var e=function(){var e=(0,a.A)((0,t.A)().mark((function e(){var n;return(0,t.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l("test-post",{data:{a:1},onFetchResponse:function(e){return{code:0,data:e.headers}}});case 2:n=e.sent,console.log(n,Object.fromEntries(n.entries()));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o("div",null,o("a",{href:"javascript:;",onClick:e},"\u70b9\u51fb\u8bf7\u6c42"))}}}]);